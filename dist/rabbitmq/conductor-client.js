var ConductorRabbitMQClient, JoukouConductorExchange, JoukouConductorRoutingKey, JoukouFleetAPIHost, JoukouFleetAPIPath, RabbitMQClient, fleet, noflo, request,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

JoukouConductorExchange = process.env["JOUKOU_CONDUCTOR_EXCHANGE"];

JoukouConductorRoutingKey = process.env["JOUKOU_CONDUCTOR_ROUTING_KEY"];

JoukouFleetAPIHost = process.env["JOUKOU_FLEET_API_HOST"];

JoukouFleetAPIPath = process.env["JOUKOU_FLEET_API_PATH"];

RabbitMQClient = require('./client').RabbitMQClient;

request = require('request');

fleet = require('../fleet');

noflo = require('../noflo/systemd');

if (!JoukouConductorExchange) {
  JoukouConductorExchange = "amqp://localhost";
  process.env["JOUKOU_CONDUCTOR_EXCHANGE"] = JoukouConductorExchange;
}

if (!JoukouConductorRoutingKey) {
  JoukouConductorRoutingKey = "CONDUCTOR";
  process.env["JOUKOU_CONDUCTOR_ROUTING_KEY"] = JoukouConductorRoutingKey;
}

if (!JoukouFleetAPIHost) {
  JoukouFleetAPIHost = "localhost:4002";
  process.env["JOUKOU_FLEET_API_HOST"] = JoukouFleetAPIHost;
}

if (!JoukouFleetAPIPath) {
  JoukouFleetAPIPath = "/v1-alpha/";
  process.env["JOUKOU_FLEET_API_PATH"] = JoukouFleetAPIPath;
}

ConductorRabbitMQClient = (function(_super) {
  __extends(ConductorRabbitMQClient, _super);

  ConductorRabbitMQClient.prototype.fleetClient = null;

  function ConductorRabbitMQClient() {
    var client;
    ConductorRabbitMQClient.__super__.constructor.call(this, JoukouConductorExchange, JoukouConductorRoutingKey);
    client = this;
    this.consume(function() {
      return client.onMessage.apply(client, arguments);
    }, true);
    this.fleetClient = fleet.getClient(JoukouFleetAPIHost, JoukouFleetAPIPath, true);
  }

  ConductorRabbitMQClient.prototype.onMessage = function(message) {
    if (!(message instanceof Object)) {
      return;
    }
    if (!(message["_links"] instanceof Object)) {
      return;
    }
    if (!(message["_links"]["joukou:graph"] instanceof Object)) {
      return;
    }
    if (!message["_links"]["joukou:graph"]["href"]) {
      return;
    }
    if (!message.desiredState) {
      return;
    }
    return this.onGraphHref(message["_links"]["joukou:graph"]["href"], message.desiredState, message.secret);
  };

  ConductorRabbitMQClient.prototype.onGraphHref = function(graphHref, desiredState, secret) {
    var client, options;
    options = null;
    if (secret) {
      options = {
        headers: {
          Authorization: "Bearer " + secret
        }
      };
    }
    client = this;
    return request.get(graphHref, options, function(error, response, body, desiredState) {
      return client.onGraphResponse.apply(client, [error, response, body, desiredState]);
    });
  };

  ConductorRabbitMQClient.prototype.onGraphResponse = function(error, response, body, desiredState) {
    var jsonBody;
    if (error || response.statusCode !== 200) {
      return;
    }
    jsonBody = null;
    try {
      jsonBody = JSON.parse(body);
    } catch (_error) {}
    if (!jsonBody) {
      return;
    }
    try {
      return this.onGraphBody(jsonBody, desiredState);
    } catch (_error) {}
  };

  ConductorRabbitMQClient.prototype.onGraphBody = function(body, desiredState) {
    var client, options;
    options = noflo.createFromSchema(body, "TODO", "TODO", "TODO");

    /*
      unitName: "name"
      options: [SystemDUnitFile].options
      machineID: machineID
     */
    client = this.fleetClient;
    return client.createUnit(options.unitName, options.options, desiredState, null, options.machineID);
  };

  return ConductorRabbitMQClient;

})(RabbitMQClient);

module.exports = {
  listen: function() {
    return new ConductorRabbitMQClient();
  },
  ConductorRabbitMQClient: ConductorRabbitMQClient
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJhYmJpdG1xL2NvbmR1Y3Rvci1jbGllbnQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUEsMEpBQUE7RUFBQTtpU0FBQTs7QUFBQSx1QkFBQSxHQUE0QixPQUFPLENBQUMsR0FBSSxDQUFBLDJCQUFBLENBQXhDLENBQUE7O0FBQUEseUJBQ0EsR0FBNEIsT0FBTyxDQUFDLEdBQUksQ0FBQSw4QkFBQSxDQUR4QyxDQUFBOztBQUFBLGtCQUdBLEdBQTRCLE9BQU8sQ0FBQyxHQUFJLENBQUEsdUJBQUEsQ0FIeEMsQ0FBQTs7QUFBQSxrQkFJQSxHQUE0QixPQUFPLENBQUMsR0FBSSxDQUFBLHVCQUFBLENBSnhDLENBQUE7O0FBQUEsY0FNQSxHQUE0QixPQUFBLENBQVEsVUFBUixDQUFtQixDQUFDLGNBTmhELENBQUE7O0FBQUEsT0FPQSxHQUE0QixPQUFBLENBQVEsU0FBUixDQVA1QixDQUFBOztBQUFBLEtBUUEsR0FBNEIsT0FBQSxDQUFRLFVBQVIsQ0FSNUIsQ0FBQTs7QUFBQSxLQVNBLEdBQTRCLE9BQUEsQ0FBUSxrQkFBUixDQVQ1QixDQUFBOztBQWFBLElBQUcsQ0FBQSx1QkFBSDtBQUNFLEVBQUEsdUJBQUEsR0FBMEIsa0JBQTFCLENBQUE7QUFBQSxFQUNBLE9BQU8sQ0FBQyxHQUFJLENBQUEsMkJBQUEsQ0FBWixHQUEyQyx1QkFEM0MsQ0FERjtDQWJBOztBQWlCQSxJQUFHLENBQUEseUJBQUg7QUFDRSxFQUFBLHlCQUFBLEdBQTRCLFdBQTVCLENBQUE7QUFBQSxFQUNBLE9BQU8sQ0FBQyxHQUFJLENBQUEsOEJBQUEsQ0FBWixHQUE4Qyx5QkFEOUMsQ0FERjtDQWpCQTs7QUFxQkEsSUFBRyxDQUFBLGtCQUFIO0FBQ0UsRUFBQSxrQkFBQSxHQUFxQixnQkFBckIsQ0FBQTtBQUFBLEVBQ0EsT0FBTyxDQUFDLEdBQUksQ0FBQSx1QkFBQSxDQUFaLEdBQXVDLGtCQUR2QyxDQURGO0NBckJBOztBQXlCQSxJQUFHLENBQUEsa0JBQUg7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LENBQVgsQ0FERjtLQUFBLGtCQUhBO0FBS0EsSUFBQSxJQUFHLENBQUEsUUFBSDtBQUNFLFlBQUEsQ0FERjtLQUxBO0FBT0E7YUFDRSxJQUFJLENBQUMsV0FBTCxDQUFpQixRQUFqQixFQUEyQixZQUEzQixFQURGO0tBQUEsa0JBUmU7RUFBQSxDQTdEakIsQ0FBQTs7QUFBQSxvQ0F1RUEsV0FBQSxHQUFhLFNBQUMsSUFBRCxFQUFPLFlBQVAsR0FBQTtBQUlYLFFBQUEsZUFBQTtBQUFBLElBQUEsT0FBQSxHQUFVLEtBQUssQ0FBQyxnQkFBTixDQUNSLElBRFEsRUFFUixNQUZRLEVBR1IsTUFIUSxFQUlSLE1BSlEsQ0FBVixDQUFBO0FBT0E7QUFBQTs7OztPQVBBO0FBQUEsSUFZQSxNQUFBLEdBQVMsSUFBSSxDQUFDLFdBWmQsQ0FBQTtXQWFBLE1BQU0sQ0FBQyxVQUFQLENBQ0UsT0FBTyxDQUFDLFFBRFYsRUFFRSxPQUFPLENBQUMsT0FGVixFQUdFLFlBSEYsRUFJRSxJQUpGLEVBS0UsT0FBTyxDQUFDLFNBTFYsRUFqQlc7RUFBQSxDQXZFYixDQUFBOztpQ0FBQTs7R0FEb0MsZUE3QnRDLENBQUE7O0FBQUEsTUE2SE0sQ0FBQyxPQUFQLEdBQ0U7QUFBQSxFQUFBLE1BQUEsRUFBUSxTQUFBLEdBQUE7V0FDRixJQUFBLHVCQUFBLENBQUEsRUFERTtFQUFBLENBQVI7QUFBQSxFQUVBLHVCQUFBLEVBQXlCLHVCQUZ6QjtDQTlIRixDQUFBIiwiZmlsZSI6InJhYmJpdG1xL2NvbmR1Y3Rvci1jbGllbnQuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyJKb3Vrb3VDb25kdWN0b3JFeGNoYW5nZSAgID0gcHJvY2Vzcy5lbnZbXCJKT1VLT1VfQ09ORFVDVE9SX0VYQ0hBTkdFXCJdXG5Kb3Vrb3VDb25kdWN0b3JSb3V0aW5nS2V5ID0gcHJvY2Vzcy5lbnZbXCJKT1VLT1VfQ09ORFVDVE9SX1JPVVRJTkdfS0VZXCJdXG5cbkpvdWtvdUZsZWV0QVBJSG9zdCAgICAgICAgPSBwcm9jZXNzLmVudltcIkpPVUtPVV9GTEVFVF9BUElfSE9TVFwiXVxuSm91a291RmxlZXRBUElQYXRoICAgICAgICA9IHByb2Nlc3MuZW52W1wiSk9VS09VX0ZMRUVUX0FQSV9QQVRIXCJdXG5cblJhYmJpdE1RQ2xpZW50ICAgICAgICAgICAgPSByZXF1aXJlKCcuL2NsaWVudCcpLlJhYmJpdE1RQ2xpZW50XG5yZXF1ZXN0ICAgICAgICAgICAgICAgICAgID0gcmVxdWlyZSgncmVxdWVzdCcpXG5mbGVldCAgICAgICAgICAgICAgICAgICAgID0gcmVxdWlyZSgnLi4vZmxlZXQnKVxubm9mbG8gICAgICAgICAgICAgICAgICAgICA9IHJlcXVpcmUoJy4uL25vZmxvL3N5c3RlbWQnKVxuXG4jIFNldCB0aGUgRU5WIHZhcmlhYmxlIGZvciBuZXh0IHRpbWVcbiMgVGhpcyBkb2VzIG5vdCBlZmZlY3QgZ2xvYmFsIGVudiBqdXN0IHRoaXMgcHJvY2Vzc1xuaWYgbm90IEpvdWtvdUNvbmR1Y3RvckV4Y2hhbmdlXG4gIEpvdWtvdUNvbmR1Y3RvckV4Y2hhbmdlID0gXCJhbXFwOi8vbG9jYWxob3N0XCJcbiAgcHJvY2Vzcy5lbnZbXCJKT1VLT1VfQ09ORFVDVE9SX0VYQ0hBTkdFXCJdID0gSm91a291Q29uZHVjdG9yRXhjaGFuZ2VcblxuaWYgbm90IEpvdWtvdUNvbmR1Y3RvclJvdXRpbmdLZXlcbiAgSm91a291Q29uZHVjdG9yUm91dGluZ0tleSA9IFwiQ09ORFVDVE9SXCJcbiAgcHJvY2Vzcy5lbnZbXCJKT1VLT1VfQ09ORFVDVE9SX1JPVVRJTkdfS0VZXCJdID0gSm91a291Q29uZHVjdG9yUm91dGluZ0tleVxuXG5pZiBub3QgSm91a291RmxlZXRBUElIb3N0XG4gIEpvdWtvdUZsZWV0QVBJSG9zdCA9IFwibG9jYWxob3N0OjQwMDJcIlxuICBwcm9jZXNzLmVudltcIkpPVUtPVV9GTEVFVF9BUElfSE9TVFwiXSA9IEpvdWtvdUZsZWV0QVBJSG9zdFxuXG5pZiBub3QgSm91a291RmxlZXRBUElQYXRoXG4gIEpvdWtvdUZsZWV0QVBJUGF0aCA9IFwiL3YxLWFscGhhL1wiXG4gIHByb2Nlc3MuZW52W1wiSk9VS09VX0ZMRUVUX0FQSV9QQVRIXCJdID0gSm91a291RmxlZXRBUElQYXRoXG5cbmNsYXNzIENvbmR1Y3RvclJhYmJpdE1RQ2xpZW50IGV4dGVuZHMgUmFiYml0TVFDbGllbnRcbiAgZmxlZXRDbGllbnQ6IG51bGxcbiAgY29uc3RydWN0b3I6IC0+XG4gICAgc3VwZXIoSm91a291Q29uZHVjdG9yRXhjaGFuZ2UsIEpvdWtvdUNvbmR1Y3RvclJvdXRpbmdLZXkpXG4gICAgY2xpZW50ID0gdGhpc1xuICAgIHRoaXMuY29uc3VtZSggLT5cbiAgICAgIGNsaWVudC5vbk1lc3NhZ2UuYXBwbHkoY2xpZW50LCBhcmd1bWVudHMpXG4gICAgLCB5ZXMpXG4gICAgdGhpcy5mbGVldENsaWVudCA9IGZsZWV0LmdldENsaWVudChcbiAgICAgIEpvdWtvdUZsZWV0QVBJSG9zdCxcbiAgICAgIEpvdWtvdUZsZWV0QVBJUGF0aCxcbiAgICAgIHllc1xuICAgIClcbiAgb25NZXNzYWdlOiAobWVzc2FnZSkgLT5cbiAgICAjIEhlcmUgd2UgbXVzdCBwcm9jZXNzIHdoYXQgdGhlIHBlZXBzXG4gICAgIyB3YW50IHRoZWlyIGdyYXBocyB0byBkb1xuICAgICMgSGVyZSBpcyBhbiBleGFtcGxlIG9mIG1lc3NhZ2VzIGZyb20gSXNhYWM6XG4gICAgIyB7XG4gICAgIyAgXCJfbGlua3NcIjoge1xuICAgICMgICAgXCJqb3Vrb3U6Z3JhcGhcIjoge1xuICAgICMgICAgICBcImhyZWZcIjpcbiAgICAjICAgICAgICAgXCJodHRwOi8vYXBpLmpvdWtvdS5sb2NhbDoyMTAxL3BlcnNvbmEvcGVyc29uYVV1aWQvZ3JhcGgvZ3JhcGhVdWlkXCJcbiAgICAjICAgIH1cbiAgICAjICB9LFxuICAgICMgIFwiZGVzaXJlZFN0YXRlXCI6IFwibGF1bmNoZWRcIiwgLy8gb3IgXCJpbmFjdGl2ZVwiXG4gICAgIyAgXCJzZWNyZXRcIjogXCJqc29uLXdlYi10b2tlblwiXG4gICAgI31cbiAgICAjIE5vIG9uZSBpcyBsaXN0ZW5pbmcgZm9yIGVycm9ycyBzbyBqdXN0IHJldHVyblxuICAgICMgaWYgdGhlcmUgaXMgc29tZXRoaW5nIG1pc3NpbmdcbiAgICBpZiBtZXNzYWdlIG5vdCBpbnN0YW5jZW9mIE9iamVjdFxuICAgICAgcmV0dXJuXG4gICAgaWYgbWVzc2FnZVtcIl9saW5rc1wiXSBub3QgaW5zdGFuY2VvZiBPYmplY3RcbiAgICAgIHJldHVyblxuICAgIGlmIG1lc3NhZ2VbXCJfbGlua3NcIl1bXCJqb3Vrb3U6Z3JhcGhcIl0gbm90IGluc3RhbmNlb2YgT2JqZWN0XG4gICAgICByZXR1cm5cbiAgICBpZiBub3QgbWVzc2FnZVtcIl9saW5rc1wiXVtcImpvdWtvdTpncmFwaFwiXVtcImhyZWZcIl1cbiAgICAgIHJldHVyblxuICAgIGlmIG5vdCBtZXNzYWdlLmRlc2lyZWRTdGF0ZVxuICAgICAgcmV0dXJuXG4gICAgI01heSBiZSBhIHB1YmxpYyBncmFwaCwgd2Ugd2lsbCB0cnkgd2l0aG91dCB0aGlzXG4gICAgI2lmIG5vdCBtZXNzYWdlLnNlY3JldFxuICAgICMgIHJldHVyblxuICAgIHRoaXMub25HcmFwaEhyZWYoXG4gICAgICBtZXNzYWdlW1wiX2xpbmtzXCJdW1wiam91a291OmdyYXBoXCJdW1wiaHJlZlwiXSxcbiAgICAgIG1lc3NhZ2UuZGVzaXJlZFN0YXRlLFxuICAgICAgbWVzc2FnZS5zZWNyZXRcbiAgICApXG4gIG9uR3JhcGhIcmVmOiAoZ3JhcGhIcmVmLCBkZXNpcmVkU3RhdGUsIHNlY3JldCkgLT5cbiAgICBvcHRpb25zID0gbnVsbFxuICAgIGlmIHNlY3JldFxuICAgICAgb3B0aW9ucyA9XG4gICAgICAgIGhlYWRlcnM6XG4gICAgICAgICAgQXV0aG9yaXphdGlvbjogXCJCZWFyZXIgI3tzZWNyZXR9XCJcbiAgICBjbGllbnQgPSB0aGlzXG4gICAgcmVxdWVzdC5nZXQoZ3JhcGhIcmVmLCBvcHRpb25zLCAoZXJyb3IsIHJlc3BvbnNlLCBib2R5LCBkZXNpcmVkU3RhdGUpIC0+XG4gICAgICBjbGllbnQub25HcmFwaFJlc3BvbnNlLmFwcGx5KGNsaWVudCwgW1xuICAgICAgICBlcnJvcixcbiAgICAgICAgcmVzcG9uc2UsXG4gICAgICAgIGJvZHksXG4gICAgICAgIGRlc2lyZWRTdGF0ZVxuICAgICAgXSlcbiAgICApXG4gIG9uR3JhcGhSZXNwb25zZTogKGVycm9yLCByZXNwb25zZSwgYm9keSwgZGVzaXJlZFN0YXRlKSAtPlxuICAgIGlmIGVycm9yIG9yIHJlc3BvbnNlLnN0YXR1c0NvZGUgaXNudCAyMDBcbiAgICAgIHJldHVyblxuICAgIGpzb25Cb2R5ID0gbnVsbFxuICAgIHRyeVxuICAgICAganNvbkJvZHkgPSBKU09OLnBhcnNlKGJvZHkpXG4gICAgaWYgbm90IGpzb25Cb2R5XG4gICAgICByZXR1cm5cbiAgICB0cnlcbiAgICAgIHRoaXMub25HcmFwaEJvZHkoanNvbkJvZHksIGRlc2lyZWRTdGF0ZSlcbiAgb25HcmFwaEJvZHk6IChib2R5LCBkZXNpcmVkU3RhdGUpIC0+XG4gICAgIyBUT0RPIEVyciBkbyBzdHVmZiBub3c/XG4gICAgIyBJbSBleHBlY3RpbmcgdGhpcyBpcyBhbG9uZyB0aGUgbGluZXMgb2ZcbiAgICAjIHdoYXQgaXMgZ29ubmEgaGFwcGVuXG4gICAgb3B0aW9ucyA9IG5vZmxvLmNyZWF0ZUZyb21TY2hlbWEoXG4gICAgICBib2R5LFxuICAgICAgXCJUT0RPXCIsXG4gICAgICBcIlRPRE9cIixcbiAgICAgIFwiVE9ET1wiXG4gICAgKVxuICAgICMgbm9mbG8uY3JlYXRlRnJvbVNjaGVtYSByZXR1cm5zIHNvbWV0aGluZyBsaWtlXG4gICAgIyMjXG4gICAgICB1bml0TmFtZTogXCJuYW1lXCJcbiAgICAgIG9wdGlvbnM6IFtTeXN0ZW1EVW5pdEZpbGVdLm9wdGlvbnNcbiAgICAgIG1hY2hpbmVJRDogbWFjaGluZUlEXG4gICAgIyMjXG4gICAgY2xpZW50ID0gdGhpcy5mbGVldENsaWVudFxuICAgIGNsaWVudC5jcmVhdGVVbml0KFxuICAgICAgb3B0aW9ucy51bml0TmFtZSxcbiAgICAgIG9wdGlvbnMub3B0aW9ucyxcbiAgICAgIGRlc2lyZWRTdGF0ZSxcbiAgICAgIG51bGwsXG4gICAgICBvcHRpb25zLm1hY2hpbmVJRFxuICAgIClcbm1vZHVsZS5leHBvcnRzID1cbiAgbGlzdGVuOiAtPlxuICAgIG5ldyBDb25kdWN0b3JSYWJiaXRNUUNsaWVudCgpXG4gIENvbmR1Y3RvclJhYmJpdE1RQ2xpZW50OiBDb25kdWN0b3JSYWJiaXRNUUNsaWVudFxuIl19